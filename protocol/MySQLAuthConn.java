import java.net.Socket;
import java.io.IOException;
import java.io.InputStream;
import java.io.OutputStream;

public class MySQLAuthConn {
  public static int[] authPacket = { 
                      0xac,0x00,0x00,0x01,0x85,0xa6,0x7f,0x00,0x00,0x00,0x00,0x01,0x21,0x00,0x00,0x00,
                      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
                      0x00,0x00,0x00,0x00,0x72,0x6f,0x6f,0x74,0x00,0x00,0x6d,0x79,0x73,0x71,0x6c,0x5f,
                      0x6e,0x61,0x74,0x69,0x76,0x65,0x5f,0x70,0x61,0x73,0x73,0x77,0x6f,0x72,0x64,0x00,
                      0x6f,0x03,0x5f,0x6f,0x73,0x0e,0x6c,0x69,0x6e,0x75,0x78,0x2d,0x67,0x6c,0x69,0x62,
                      0x63,0x32,0x2e,0x35,0x0c,0x5f,0x63,0x6c,0x69,0x65,0x6e,0x74,0x5f,0x6e,0x61,0x6d,
                      0x65,0x08,0x6c,0x69,0x62,0x6d,0x79,0x73,0x71,0x6c,0x04,0x5f,0x70,0x69,0x64,0x05,
                      0x31,0x33,0x36,0x37,0x34,0x0f,0x5f,0x63,0x6c,0x69,0x65,0x6e,0x74,0x5f,0x76,0x65,
                      0x72,0x73,0x69,0x6f,0x6e,0x06,0x35,0x2e,0x36,0x2e,0x31,0x32,0x09,0x5f,0x70,0x6c,
                      0x61,0x74,0x66,0x6f,0x72,0x6d,0x06,0x78,0x38,0x36,0x5f,0x36,0x34,0x0c,0x70,0x72,
                      0x6f,0x67,0x72,0x61,0x6d,0x5f,0x6e,0x61,0x6d,0x65,0x05,0x6d,0x79,0x73,0x71,0x6c };
  public static void main(String[] argvs) {
    Socket socket = null;
    try {
      socket = new Socket("172.16.90.12", 13001);
      socket.setSoTimeout(5000);
      InputStream in = socket.getInputStream();
      OutputStream out = socket.getOutputStream();
      int c = in.read();
      int length = c;
      System.out.println("MySQL hand shake packet");
      for (int i = 0; i < length + 3 ; i++) {
        System.out.print(Integer.toHexString(c) + " ");
        c = in.read();
      }
      System.out.print(Integer.toHexString(c) + " ");
      System.out.println();
      System.out.println("MySQL auth packet");
      for (int i = 0; i < authPacket.length; i++) {
        out.write(authPacket[i]);
      }
      System.out.println("MySQL auth response packet");
      c = in.read();
      length = c;
      for (int i = 0; i < length + 3 ;i ++) {
        System.out.print(Integer.toHexString(c) + " ");
        c = in.read();
      }
      System.out.print(Integer.toHexString(c) + " ");
      System.out.println();
      System.out.println("the forth is 0x00 , so auth success");
      System.out.println("end");
    } catch (IOException e) {
      System.out.println(e);
    } finally {
      if (socket != null) {
        try {
          socket.close();
        } catch (IOException e) {
          System.out.println(e);
        }
      }
    }

  }
}
